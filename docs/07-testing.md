# ç¬¬ä¸ƒç« ï¼šæµ‹è¯•ç¼–å†™

## ğŸ§ª æµ‹è¯•çš„é‡è¦æ€§

æµ‹è¯•æ˜¯è½¯ä»¶å¼€å‘ä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€ç¯ï¼Œç‰¹åˆ«æ˜¯åœ¨ Go è¯­è¨€ä¸­ï¼Œæµ‹è¯•è¢«è§†ä¸ºä¸€ç­‰å…¬æ°‘ã€‚å¥½çš„æµ‹è¯•ä¸ä»…èƒ½å‘ç° bugï¼Œè¿˜èƒ½ï¼š

1. **æ–‡æ¡£åŒ–ä»£ç è¡Œä¸º**ï¼šæµ‹è¯•ç”¨ä¾‹å°±æ˜¯æœ€å¥½çš„ä½¿ç”¨ç¤ºä¾‹
2. **æ”¯æŒé‡æ„**ï¼šæœ‰äº†æµ‹è¯•ä¿æŠ¤ï¼Œå¯ä»¥å®‰å…¨åœ°ä¿®æ”¹ä»£ç 
3. **æé«˜ä»£ç è´¨é‡**ï¼šç¼–å†™å¯æµ‹è¯•çš„ä»£ç é€šå¸¸è´¨é‡æ›´é«˜
4. **å¢å¼ºä¿¡å¿ƒ**ï¼šå®Œå–„çš„æµ‹è¯•è®©å¼€å‘è€…æ›´æœ‰ä¿¡å¿ƒå‘å¸ƒä»£ç 

## ğŸ“‹ Go æµ‹è¯•åŸºç¡€

### æµ‹è¯•æ–‡ä»¶å‘½åè§„åˆ™

Go è¯­è¨€çš„æµ‹è¯•æ–‡ä»¶å¿…é¡»éµå¾ªç‰¹å®šçš„å‘½åè§„åˆ™ï¼š

```
main.go      -> main_test.go
game.go      -> game_test.go
utils.go     -> utils_test.go
```

**è§„åˆ™**ï¼š
- æµ‹è¯•æ–‡ä»¶åå¿…é¡»ä»¥ `_test.go` ç»“å°¾
- æµ‹è¯•æ–‡ä»¶ä¸è¢«æµ‹è¯•æ–‡ä»¶åœ¨åŒä¸€ä¸ªåŒ…ä¸­

### æµ‹è¯•å‡½æ•°å‘½åè§„åˆ™

```go
func TestFunctionName(t *testing.T) { ... }    // å•å…ƒæµ‹è¯•
func BenchmarkFunctionName(b *testing.B) { ... } // åŸºå‡†æµ‹è¯•
func ExampleFunctionName() { ... }              // ç¤ºä¾‹æµ‹è¯•
```

## ğŸ”¬ å•å…ƒæµ‹è¯•å®ç°

### æµ‹è¯• NewGame å‡½æ•°

```go
package main

import (
    "testing"
)

// TestNewGame æµ‹è¯•æ¸¸æˆåˆ›å»º
func TestNewGame(t *testing.T) {
    game := NewGame()
    
    if game == nil {
        t.Fatal("NewGame() è¿”å›äº† nil")
    }
    
    if game.targetNumber < 1 || game.targetNumber > 100 {
        t.Errorf("ç›®æ ‡æ•°å­— %d ä¸åœ¨ 1-100 èŒƒå›´å†…", game.targetNumber)
    }
    
    if game.attempts != 0 {
        t.Errorf("åˆå§‹çŒœæµ‹æ¬¡æ•°åº”è¯¥ä¸º 0ï¼Œå®é™…ä¸º %d", game.attempts)
    }
}
```

#### æµ‹è¯•è¦ç‚¹åˆ†æ

1. **ç©ºå€¼æ£€æŸ¥**ï¼š
   ```go
   if game == nil {
       t.Fatal("NewGame() è¿”å›äº† nil")
   }
   ```
   - ä½¿ç”¨ `t.Fatal()` è€Œä¸æ˜¯ `t.Error()`
   - å› ä¸ºå¦‚æœ game ä¸º nilï¼Œåç»­æµ‹è¯•ä¼š panic

2. **èŒƒå›´éªŒè¯**ï¼š
   ```go
   if game.targetNumber < 1 || game.targetNumber > 100 {
       t.Errorf("ç›®æ ‡æ•°å­— %d ä¸åœ¨ 1-100 èŒƒå›´å†…", game.targetNumber)
   }
   ```
   - éªŒè¯éšæœºæ•°ç”Ÿæˆçš„æ­£ç¡®æ€§
   - ä½¿ç”¨ `t.Errorf()` æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

3. **åˆå§‹çŠ¶æ€æ£€æŸ¥**ï¼š
   ```go
   if game.attempts != 0 {
       t.Errorf("åˆå§‹çŒœæµ‹æ¬¡æ•°åº”è¯¥ä¸º 0ï¼Œå®é™…ä¸º %d", game.attempts)
   }
   ```

### æµ‹è¯• checkGuess æ–¹æ³•

```go
// TestCheckGuess æµ‹è¯•çŒœæµ‹æ£€æŸ¥é€»è¾‘
func TestCheckGuess(t *testing.T) {
    game := &Game{targetNumber: 50, attempts: 0}
    
    // æµ‹è¯•çŒœå¯¹
    result := game.checkGuess(50)
    if result != 0 {
        t.Errorf("çŒœå¯¹æ—¶åº”è¯¥è¿”å› 0ï¼Œå®é™…è¿”å› %d", result)
    }
    
    // æµ‹è¯•çŒœå¤§äº†
    result = game.checkGuess(75)
    if result <= 0 {
        t.Errorf("çŒœå¤§æ—¶åº”è¯¥è¿”å›æ­£æ•°ï¼Œå®é™…è¿”å› %d", result)
    }
    
    // æµ‹è¯•çŒœå°äº†
    result = game.checkGuess(25)
    if result >= 0 {
        t.Errorf("çŒœå°æ—¶åº”è¯¥è¿”å›è´Ÿæ•°ï¼Œå®é™…è¿”å› %d", result)
    }
}
```

#### æµ‹è¯•è®¾è®¡æ€è·¯

1. **åˆ›å»ºæµ‹è¯•å®ä¾‹**ï¼š
   ```go
   game := &Game{targetNumber: 50, attempts: 0}
   ```
   - ç›´æ¥åˆ›å»ºç»“æ„ä½“å®ä¾‹ï¼Œä¸ä¾èµ– `NewGame()`
   - ä½¿ç”¨å›ºå®šçš„ç›®æ ‡æ•°å­—ï¼Œç¡®ä¿æµ‹è¯•ç»“æœå¯é¢„æµ‹

2. **è¦†ç›–æ‰€æœ‰åˆ†æ”¯**ï¼š
   - çŒœå¯¹ï¼š`guess == target`
   - çŒœå¤§ï¼š`guess > target`
   - çŒœå°ï¼š`guess < target`

3. **éªŒè¯è¿”å›å€¼**ï¼š
   - ä¸ä»…æ£€æŸ¥è¿”å›å€¼çš„æ­£ç¡®æ€§
   - è¿˜æ£€æŸ¥è¿”å›å€¼çš„ç¬¦å·ï¼ˆæ­£æ•°ã€è´Ÿæ•°ã€é›¶ï¼‰

### æµ‹è¯•éšæœºæ€§

```go
// TestRandomness æµ‹è¯•éšæœºæ•°ç”Ÿæˆçš„å¤šæ ·æ€§
func TestRandomness(t *testing.T) {
    numbers := make(map[int]bool)
    
    // ç”Ÿæˆå¤šä¸ªæ¸¸æˆå®ä¾‹ï¼Œæ£€æŸ¥ç›®æ ‡æ•°å­—çš„å¤šæ ·æ€§
    for i := 0; i < 20; i++ {
        game := NewGame()
        numbers[game.targetNumber] = true
    }
    
    // è‡³å°‘åº”è¯¥æœ‰å‡ ä¸ªä¸åŒçš„æ•°å­—ï¼ˆè€ƒè™‘åˆ°éšæœºæ€§ï¼Œä¸è¦æ±‚å¤ªä¸¥æ ¼ï¼‰
    if len(numbers) < 3 {
        t.Errorf("éšæœºæ•°ç”Ÿæˆç¼ºä¹å¤šæ ·æ€§ï¼Œ20æ¬¡ç”Ÿæˆåªæœ‰ %d ä¸ªä¸åŒæ•°å­—", len(numbers))
    }
}
```

#### éšæœºæ€§æµ‹è¯•çš„æŒ‘æˆ˜

1. **ä¸ç¡®å®šæ€§**ï¼šéšæœºæµ‹è¯•ç»“æœä¸ç¡®å®š
2. **å¹³è¡¡æ€§**ï¼šæ—¢è¦æ£€æµ‹éšæœºæ€§ï¼Œåˆä¸èƒ½è¿‡äºä¸¥æ ¼
3. **é‡å¤æ€§**ï¼šæµ‹è¯•åº”è¯¥èƒ½å¤Ÿé‡å¤è¿è¡Œ

#### è§£å†³æ–¹æ¡ˆ

1. **ç»Ÿè®¡æ–¹æ³•**ï¼šä½¿ç”¨å¤§æ ·æœ¬æ£€æµ‹åˆ†å¸ƒ
2. **åˆç†é˜ˆå€¼**ï¼šè®¾ç½®åˆç†çš„æœŸæœ›å€¼
3. **å¤šæ¬¡è¿è¡Œ**ï¼šåœ¨ CI/CD ä¸­å¤šæ¬¡è¿è¡Œæµ‹è¯•

## ğŸ“Š åŸºå‡†æµ‹è¯•

### åŸºå‡†æµ‹è¯•çš„ä½œç”¨

1. **æ€§èƒ½æµ‹é‡**ï¼šæµ‹é‡å‡½æ•°çš„æ‰§è¡Œæ—¶é—´
2. **æ€§èƒ½å¯¹æ¯”**ï¼šæ¯”è¾ƒä¸åŒå®ç°çš„æ€§èƒ½
3. **æ€§èƒ½å›å½’æ£€æµ‹**ï¼šç¡®ä¿æ€§èƒ½ä¸ä¼šé€€åŒ–

### å®ç°åŸºå‡†æµ‹è¯•

```go
// BenchmarkNewGame åŸºå‡†æµ‹è¯•æ¸¸æˆåˆ›å»ºæ€§èƒ½
func BenchmarkNewGame(b *testing.B) {
    for i := 0; i < b.N; i++ {
        NewGame()
    }
}

// BenchmarkCheckGuess åŸºå‡†æµ‹è¯•çŒœæµ‹æ£€æŸ¥æ€§èƒ½
func BenchmarkCheckGuess(b *testing.B) {
    game := &Game{targetNumber: 50}
    
    b.ResetTimer()
    for i := 0; i < b.N; i++ {
        game.checkGuess(25)
    }
}
```

#### åŸºå‡†æµ‹è¯•è¦ç‚¹

1. **å¾ªç¯ç»“æ„**ï¼š
   ```go
   for i := 0; i < b.N; i++ {
       // è¢«æµ‹è¯•çš„ä»£ç 
   }
   ```
   - `b.N` ç”±æµ‹è¯•æ¡†æ¶è‡ªåŠ¨è°ƒæ•´
   - æ¡†æ¶ä¼šè¿è¡Œè¶³å¤Ÿå¤šæ¬¡ä»¥è·å¾—ç¨³å®šçš„æµ‹é‡ç»“æœ

2. **é‡ç½®è®¡æ—¶å™¨**ï¼š
   ```go
   b.ResetTimer()
   ```
   - åœ¨å‡†å¤‡å·¥ä½œå®Œæˆåé‡ç½®è®¡æ—¶å™¨
   - ç¡®ä¿åªæµ‹é‡æ ¸å¿ƒé€»è¾‘çš„æ€§èƒ½

3. **é¿å…ç¼–è¯‘å™¨ä¼˜åŒ–**ï¼š
   ```go
   // å¦‚æœéœ€è¦ä½¿ç”¨ç»“æœï¼Œå¯ä»¥èµ‹å€¼ç»™åŒ…çº§å˜é‡
   var result int
   
   func BenchmarkCheckGuess(b *testing.B) {
       game := &Game{targetNumber: 50}
       var r int
       
       b.ResetTimer()
       for i := 0; i < b.N; i++ {
           r = game.checkGuess(25)
       }
       result = r // é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–æ‰å‡½æ•°è°ƒç”¨
   }
   ```

## ğŸ¯ è¡¨æ ¼é©±åŠ¨æµ‹è¯•

### ä»€ä¹ˆæ˜¯è¡¨æ ¼é©±åŠ¨æµ‹è¯•ï¼Ÿ

è¡¨æ ¼é©±åŠ¨æµ‹è¯•æ˜¯ Go è¯­è¨€ä¸­å¸¸ç”¨çš„æµ‹è¯•æ¨¡å¼ï¼Œé€šè¿‡å®šä¹‰æµ‹è¯•ç”¨ä¾‹è¡¨æ ¼æ¥æ‰¹é‡æ‰§è¡Œæµ‹è¯•ã€‚

### å®ç°è¡¨æ ¼é©±åŠ¨æµ‹è¯•

```go
func TestCheckGuessTableDriven(t *testing.T) {
    game := &Game{targetNumber: 50}
    
    tests := []struct {
        name     string
        guess    int
        expected int
    }{
        {"çŒœå¯¹äº†", 50, 0},
        {"çŒœå¤§äº†", 75, 1},
        {"çŒœå°äº†", 25, -1},
        {"è¾¹ç•Œå€¼-æœ€å°", 1, -1},
        {"è¾¹ç•Œå€¼-æœ€å¤§", 100, 1},
    }
    
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            result := game.checkGuess(tt.guess)
            if result != tt.expected {
                t.Errorf("checkGuess(%d) = %d, æœŸæœ› %d", 
                    tt.guess, result, tt.expected)
            }
        })
    }
}
```

#### è¡¨æ ¼é©±åŠ¨æµ‹è¯•çš„ä¼˜åŠ¿

1. **æ¸…æ™°çš„æµ‹è¯•ç”¨ä¾‹**ï¼šæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ä¸€ç›®äº†ç„¶
2. **æ˜“äºæ·»åŠ ç”¨ä¾‹**ï¼šåªéœ€åœ¨è¡¨æ ¼ä¸­æ·»åŠ æ–°è¡Œ
3. **å­æµ‹è¯•æ”¯æŒ**ï¼šæ¯ä¸ªç”¨ä¾‹éƒ½æ˜¯ç‹¬ç«‹çš„å­æµ‹è¯•
4. **è¯¦ç»†çš„é”™è¯¯æŠ¥å‘Š**ï¼šå¯ä»¥ç²¾ç¡®å®šä½å¤±è´¥çš„ç”¨ä¾‹

## ğŸ” æµ‹è¯•è¦†ç›–ç‡

### ä»€ä¹ˆæ˜¯æµ‹è¯•è¦†ç›–ç‡ï¼Ÿ

æµ‹è¯•è¦†ç›–ç‡æ˜¯è¡¡é‡æµ‹è¯•è´¨é‡çš„é‡è¦æŒ‡æ ‡ï¼Œè¡¨ç¤ºæµ‹è¯•æ‰§è¡Œäº†å¤šå°‘ä»£ç ã€‚

### æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡

```bash
# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
go test -cover

# ç”Ÿæˆè¯¦ç»†çš„è¦†ç›–ç‡æŠ¥å‘Š
go test -coverprofile=coverage.out

# æŸ¥çœ‹ HTML æ ¼å¼çš„è¦†ç›–ç‡æŠ¥å‘Š
go tool cover -html=coverage.out
```

### è¦†ç›–ç‡åˆ†æ

```bash
# ç¤ºä¾‹è¾“å‡º
PASS
coverage: 85.7% of statements
ok      guess-number-game    0.002s
```

#### è¦†ç›–ç‡æŒ‡æ ‡

1. **è¯­å¥è¦†ç›–ç‡**ï¼šæ‰§è¡Œäº†å¤šå°‘è¯­å¥
2. **åˆ†æ”¯è¦†ç›–ç‡**ï¼šæ‰§è¡Œäº†å¤šå°‘åˆ†æ”¯
3. **å‡½æ•°è¦†ç›–ç‡**ï¼šè°ƒç”¨äº†å¤šå°‘å‡½æ•°

#### æé«˜è¦†ç›–ç‡çš„æ–¹æ³•

1. **æµ‹è¯•æ‰€æœ‰åˆ†æ”¯**ï¼šç¡®ä¿ if-else çš„æ¯ä¸ªåˆ†æ”¯éƒ½è¢«æµ‹è¯•
2. **æµ‹è¯•è¾¹ç•Œæ¡ä»¶**ï¼šæµ‹è¯•è¾¹ç•Œå€¼å’Œå¼‚å¸¸æƒ…å†µ
3. **æµ‹è¯•é”™è¯¯è·¯å¾„**ï¼šä¸ä»…æµ‹è¯•æ­£å¸¸æµç¨‹ï¼Œè¿˜è¦æµ‹è¯•é”™è¯¯å¤„ç†

## ğŸ§ª æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•å‘½å

```go
// å¥½çš„å‘½å
func TestNewGame(t *testing.T) { ... }
func TestCheckGuess_WhenGuessIsCorrect(t *testing.T) { ... }
func TestCheckGuess_WhenGuessIsTooHigh(t *testing.T) { ... }

// ä¸å¥½çš„å‘½å
func Test1(t *testing.T) { ... }
func TestStuff(t *testing.T) { ... }
```

### 2. æµ‹è¯•ç»“æ„

```go
func TestFunction(t *testing.T) {
    // Arrange - å‡†å¤‡æµ‹è¯•æ•°æ®
    game := &Game{targetNumber: 50}
    
    // Act - æ‰§è¡Œè¢«æµ‹è¯•çš„æ“ä½œ
    result := game.checkGuess(75)
    
    // Assert - éªŒè¯ç»“æœ
    if result <= 0 {
        t.Errorf("æœŸæœ›æ­£æ•°ï¼Œå¾—åˆ° %d", result)
    }
}
```

### 3. é”™è¯¯ä¿¡æ¯

```go
// å¥½çš„é”™è¯¯ä¿¡æ¯
t.Errorf("checkGuess(%d) = %d, æœŸæœ› %d", guess, result, expected)

// ä¸å¥½çš„é”™è¯¯ä¿¡æ¯
t.Error("æµ‹è¯•å¤±è´¥")
```

### 4. æµ‹è¯•ç‹¬ç«‹æ€§

```go
// æ¯ä¸ªæµ‹è¯•éƒ½åº”è¯¥ç‹¬ç«‹
func TestA(t *testing.T) {
    // ä¸ä¾èµ–å…¶ä»–æµ‹è¯•çš„ç»“æœ
}

func TestB(t *testing.T) {
    // ä¸ä¾èµ– TestA çš„æ‰§è¡Œ
}
```

## ğŸš€ è¿è¡Œæµ‹è¯•

### åŸºæœ¬å‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
go test

# è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
go test -v

# è¿è¡Œç‰¹å®šçš„æµ‹è¯•
go test -run TestNewGame

# è¿è¡ŒåŸºå‡†æµ‹è¯•
go test -bench=.

# è¿è¡ŒåŸºå‡†æµ‹è¯•å¹¶æ˜¾ç¤ºå†…å­˜åˆ†é…
go test -bench=. -benchmem

# æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡
go test -cover
```

### é«˜çº§é€‰é¡¹

```bash
# å¹¶è¡Œè¿è¡Œæµ‹è¯•
go test -parallel 4

# è®¾ç½®è¶…æ—¶æ—¶é—´
go test -timeout 30s

# è¿è¡Œæµ‹è¯•å¤šæ¬¡
go test -count 10

# ç«æ€æ£€æµ‹
go test -race
```

## ğŸ“Š æµ‹è¯•æŠ¥å‘Šè§£è¯»

### å•å…ƒæµ‹è¯•æŠ¥å‘Š

```
=== RUN   TestNewGame
--- PASS: TestNewGame (0.00s)
=== RUN   TestCheckGuess
--- PASS: TestCheckGuess (0.00s)
=== RUN   TestRandomness
--- PASS: TestRandomness (0.00s)
PASS
coverage: 85.7% of statements
ok      guess-number-game    0.002s
```

### åŸºå‡†æµ‹è¯•æŠ¥å‘Š

```
BenchmarkNewGame-8         1000000      1023 ns/op
BenchmarkCheckGuess-8     50000000        32.1 ns/op
```

**è§£è¯»**ï¼š
- `BenchmarkNewGame-8`ï¼šå‡½æ•°åå’Œ GOMAXPROCS
- `1000000`ï¼šæ‰§è¡Œæ¬¡æ•°
- `1023 ns/op`ï¼šæ¯æ¬¡æ“ä½œçš„å¹³å‡æ—¶é—´

## ğŸ¯ æœ¬ç« æ€»ç»“

åœ¨è¿™ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº† Go è¯­è¨€çš„æµ‹è¯•æŠ€æœ¯ï¼š

1. âœ… **å•å…ƒæµ‹è¯•**ï¼šç¼–å†™äº†å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹
2. âœ… **åŸºå‡†æµ‹è¯•**ï¼šæµ‹é‡äº†å‡½æ•°çš„æ€§èƒ½
3. âœ… **è¡¨æ ¼é©±åŠ¨æµ‹è¯•**ï¼šå­¦ä¹ äº†é«˜æ•ˆçš„æµ‹è¯•æ¨¡å¼
4. âœ… **æµ‹è¯•è¦†ç›–ç‡**ï¼šäº†è§£äº†å¦‚ä½•è¡¡é‡æµ‹è¯•è´¨é‡
5. âœ… **æµ‹è¯•æœ€ä½³å®è·µ**ï¼šæŒæ¡äº†æµ‹è¯•ç¼–å†™çš„è§„èŒƒ

### å…³é”®æ”¶è·

- **æµ‹è¯•æ˜¯æ–‡æ¡£**ï¼šå¥½çš„æµ‹è¯•å°±æ˜¯æœ€å¥½çš„ä½¿ç”¨è¯´æ˜
- **æµ‹è¯•é©±åŠ¨å¼€å‘**ï¼šå…ˆå†™æµ‹è¯•ï¼Œå†å†™å®ç°
- **æŒç»­æµ‹è¯•**ï¼šæ¯æ¬¡ä¿®æ”¹ä»£ç éƒ½è¦è¿è¡Œæµ‹è¯•
- **è´¨é‡ä¿è¯**ï¼šæµ‹è¯•æ˜¯ä»£ç è´¨é‡çš„é‡è¦ä¿éšœ

## ğŸš€ ä¸‹ä¸€æ­¥

åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†ï¼š
- å®Œå–„é¡¹ç›®æ–‡æ¡£
- ä¼˜åŒ–ä»£ç ç»“æ„
- æ·»åŠ ä»£ç æ³¨é‡Š
- å‡†å¤‡é¡¹ç›®å‘å¸ƒ

æµ‹è¯•ç¼–å†™å®Œæˆï¼Œè®©æˆ‘ä»¬ç»§ç»­å®Œå–„é¡¹ç›®ï¼
